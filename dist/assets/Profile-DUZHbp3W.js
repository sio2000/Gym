import{i as R,B as E,u as z,r as x,R as T,j as e,D as M,X,U as B,M as q,P as H,c as J,S as K,z as g}from"./index-DHSZwrOZ.js";import{K as O}from"./key-DfhU6fKk.js";import{P as V,S as Y}from"./save-ChvGLH4W.js";import{M as $}from"./map-pin-C587qDo4.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=R("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=R("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),Q=async(s,d)=>{try{if(console.log("[ProfileUtils] ===== UPLOAD PROFILE PHOTO STARTED ====="),console.log("[ProfileUtils] File:",s.name,"Size:",s.size,"Type:",s.type),console.log("[ProfileUtils] User ID:",d),!s.type.startsWith("image/"))throw new Error("Παρακαλώ επιλέξτε ένα αρχείο εικόνας");if(s.size>5*1024*1024)throw new Error("Το αρχείο είναι πολύ μεγάλο. Μέγιστο μέγεθος: 5MB");const t=s.name.split(".").pop(),c=`${d}/profile_photo.${t}`;console.log("[ProfileUtils] Uploading to:",c);const{data:p,error:m}=await E.storage.from("profile-photos").upload(c,s,{cacheControl:"3600",upsert:!0});if(m)throw console.error("[ProfileUtils] Upload error:",m),m;console.log("[ProfileUtils] Upload successful, data:",p);const{data:{publicUrl:j}}=E.storage.from("profile-photos").getPublicUrl(c);return console.log("[ProfileUtils] Public URL:",j),console.log("[ProfileUtils] ===== UPLOAD PROFILE PHOTO COMPLETED ====="),j}catch(t){throw console.error("[ProfileUtils] ===== UPLOAD PROFILE PHOTO FAILED ====="),console.error("Error uploading profile photo:",t),t}},Z=s=>{const d=new Date,t=new Date(s);let c=d.getFullYear()-t.getFullYear();const p=d.getMonth()-t.getMonth();return(p<0||p===0&&d.getDate()<t.getDate())&&c--,c},k=s=>new Date(s).toLocaleDateString("el-GR",{year:"numeric",month:"long",day:"numeric"}),le=()=>{const{user:s,updateProfile:d}=z(),[t,c]=x.useState(!1),[p,m]=x.useState(!1),[j,b]=x.useState(!1),[a,N]=x.useState({firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",dob:(s==null?void 0:s.dob)||"",address:(s==null?void 0:s.address)||"",emergency_contact:(s==null?void 0:s.emergency_contact)||"",profile_photo:(s==null?void 0:s.profile_photo)||"",profile_photo_locked:(s==null?void 0:s.profile_photo_locked)||!1,dob_locked:(s==null?void 0:s.dob_locked)||!1,notifications:!0,emailUpdates:!0,language:(s==null?void 0:s.language)||"el"}),[u,C]=x.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[h,F]=x.useState({pushNotifications:!0,emailNotifications:!0,smsNotifications:!1,marketingEmails:!1,lessonReminders:!0,paymentReminders:!0,referralUpdates:!0}),[y,_]=x.useState(null),[S,w]=x.useState("");T.useEffect(()=>{s&&(N({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",phone:s.phone||"",dob:s.dob||"",address:s.address||"",emergency_contact:s.emergency_contact||"",profile_photo:s.profile_photo||"",profile_photo_locked:s.profile_photo_locked||!1,dob_locked:s.dob_locked||!1,notifications:!0,emailUpdates:!0,language:s.language||"el"}),s.profile_photo&&w(s.profile_photo))},[s]);const o=r=>{const{name:l,value:n,type:i}=r.target;N(P=>({...P,[l]:i==="checkbox"?r.target.checked:n}))},L=r=>{var n;const l=(n=r.target.files)==null?void 0:n[0];if(l){if(a.profile_photo_locked){g.error("Η φωτογραφία προφίλ δεν μπορεί να αλλάξει");return}_(l);const i=new FileReader;i.onload=P=>{var D;w((D=P.target)==null?void 0:D.result)},i.readAsDataURL(l)}},v=r=>{const{name:l,value:n}=r.target;C(i=>({...i,[l]:n}))},f=r=>{const{name:l,checked:n}=r.target;F(i=>({...i,[l]:n}))},U=async r=>{r.preventDefault();try{console.log("[Profile] ===== FORM SUBMISSION STARTED ====="),console.log("[Profile] Form data:",JSON.stringify(a,null,2)),console.log("[Profile] Profile photo file:",y);let l={...a};if(y){console.log("[Profile] Uploading profile photo...");const i=await Q(y,(s==null?void 0:s.id)||"");console.log("[Profile] Upload successful, public URL:",i),l={...a,profile_photo:i,profile_photo_locked:!0},console.log("[Profile] Final form data after photo upload:",JSON.stringify(l,null,2)),_(null),w(i),N(l)}const n={...l,dob_locked:l.dob?!0:l.dob_locked};console.log("[Profile] Updated data to send:",JSON.stringify(n,null,2)),console.log("[Profile] Calling updateProfile..."),await d(n),c(!1),console.log("[Profile] ===== FORM SUBMISSION COMPLETED ====="),g.success("Το προφίλ ενημερώθηκε επιτυχώς!")}catch(l){console.error("[Profile] ===== FORM SUBMISSION FAILED ====="),console.error("[Profile] Error details:",l),g.error("Σφάλμα κατά την ενημέρωση του προφίλ")}},I=async r=>{if(r.preventDefault(),u.newPassword!==u.confirmPassword){g.error("Οι κωδικοί δεν ταιριάζουν");return}g.success("Ο κωδικός πρόσβασης άλλαξε επιτυχώς!"),m(!1),C({currentPassword:"",newPassword:"",confirmPassword:""})},A=()=>{g.success("Οι προτιμήσεις ειδοποιήσεων αποθηκεύτηκαν!"),b(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Προφίλ Χρήστη"}),e.jsx("p",{className:"text-gray-600",children:"Διαχειριστείτε τις πληροφορίες και τις ρυθμίσεις του λογαριασμού σας"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>b(!0),className:"btn-secondary flex items-center",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Ειδοποιήσεις"]}),e.jsxs("button",{onClick:()=>m(!0),className:"btn-secondary flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Αλλαγή Κωδικού"]}),t?e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>c(!1),className:"btn-secondary flex items-center",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Ακύρωση"]}),e.jsxs("button",{onClick:U,className:"btn-primary flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Αποθήκευση"]})]}):e.jsxs("button",{onClick:()=>c(!0),className:"btn-primary flex items-center",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Επεξεργασία"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Πληροφορίες Προφίλ"}),e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"relative",children:[S||a.profile_photo?e.jsx("img",{src:S||a.profile_photo,alt:"Profile",className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200"}):e.jsx("div",{className:"w-24 h-24 bg-primary-100 rounded-full flex items-center justify-center border-4 border-gray-200",children:e.jsx(B,{className:"h-12 w-12 text-primary-600"})}),!a.profile_photo_locked&&t&&e.jsxs("label",{className:"absolute -bottom-2 -right-2 p-2 bg-primary-600 text-white rounded-full hover:bg-primary-700 transition-colors cursor-pointer",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("input",{type:"file",accept:"image/*",onChange:L,className:"hidden"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]}),e.jsx("p",{className:"text-gray-600 capitalize",children:s==null?void 0:s.role}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Μέλος από ",k((s==null?void 0:s.createdAt)||"")]}),a.profile_photo_locked?e.jsx("div",{className:"mt-2 bg-green-50 border border-green-200 rounded-lg p-2",children:e.jsx("p",{className:"text-green-800 text-xs font-medium",children:"🔒 Η φωτογραφία προφίλ είναι κλειδωμένη"})}):e.jsxs("div",{className:"mt-2 bg-blue-50 border border-blue-200 rounded-lg p-2",children:[e.jsx("p",{className:"text-blue-800 text-xs font-medium",children:"📸 Επιλέξτε φωτογραφία προφίλ"}),e.jsx("p",{className:"text-blue-600 text-xs",children:"Μπορείτε να την αλλάξετε μόνο μία φορά"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Όνομα"}),e.jsx("input",{type:"text",name:"firstName",value:a.firstName,onChange:o,disabled:!t,className:"input-field disabled:bg-gray-50 disabled:text-gray-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Επώνυμο"}),e.jsx("input",{type:"text",name:"lastName",value:a.lastName,onChange:o,disabled:!t,className:"input-field disabled:bg-gray-50 disabled:text-gray-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"email",name:"email",value:a.email,onChange:o,disabled:!t,className:"input-field pl-10 disabled:bg-gray-50 disabled:text-gray-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Τηλέφωνο"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"tel",name:"phone",value:a.phone,onChange:o,disabled:!t,placeholder:"+30 69XXXXXXXX",className:"input-field pl-10 disabled:bg-gray-50 disabled:text-gray-500"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"form-label",children:"Ημερομηνία Γέννησης"}),a.dob_locked&&e.jsx("span",{className:"text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full",children:"🔒 Κλειδωμένο"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"date",name:"dob",value:a.dob,onChange:o,disabled:!t||a.dob_locked,className:"input-field pl-10 disabled:bg-gray-50 disabled:text-gray-500"})]}),a.dob&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Ηλικία: ",Z(a.dob)," ετών"]}),a.dob_locked?e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Η ημερομηνία γέννησης είναι κλειδωμένη"}):e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Μπορείτε να την ορίσετε μόνο μία φορά"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Γλώσσα"}),e.jsxs("select",{name:"language",value:a.language,onChange:o,disabled:!t,className:"input-field disabled:bg-gray-50 disabled:text-gray-500",children:[e.jsx("option",{value:"el",children:"Ελληνικά"}),e.jsx("option",{value:"en",children:"English"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Διεύθυνση"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",name:"address",value:a.address,onChange:o,disabled:!t,placeholder:"Οδός, Αριθμός, Πόλη, ΤΚ",className:"input-field pl-10 disabled:bg-gray-50 disabled:text-gray-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Επείγουσα Επικοινωνία"}),e.jsx("input",{type:"text",name:"emergency_contact",value:a.emergency_contact,onChange:o,disabled:!t,placeholder:"Όνομα και τηλέφωνο επείγουσας επικοινωνίας",className:"input-field disabled:bg-gray-50 disabled:text-gray-500"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Προτιμήσεις"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",name:"notifications",checked:a.notifications,onChange:o,disabled:!t,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{className:"text-sm text-gray-700",children:"Ειδοποιήσεις push"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",name:"emailUpdates",checked:a.emailUpdates,onChange:o,disabled:!t,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{className:"text-sm text-gray-700",children:"Ενημερώσεις μέσω email"})]})]})]})]})}),e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Κατάσταση Λογαριασμού"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Ρόλος:"}),e.jsx("span",{className:"font-medium capitalize",children:s==null?void 0:s.role})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Κωδικός παραπομπής:"}),e.jsx("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:s==null?void 0:s.referralCode})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Εγγραφή:"}),e.jsx("span",{className:"font-medium",children:k((s==null?void 0:s.createdAt)||"")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Τελευταία ενημέρωση:"}),e.jsx("span",{className:"font-medium",children:k((s==null?void 0:s.updatedAt)||"")})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Γρήγορες Ενέργειες"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>m(!0),className:"w-full btn-secondary text-left flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Αλλαγή κωδικού πρόσβασης"]}),e.jsxs("button",{onClick:()=>b(!0),className:"w-full btn-secondary text-left flex items-center",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Ρυθμίσεις ειδοποιήσεων"]}),e.jsxs("button",{className:"w-full btn-secondary text-left flex items-center",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Ασφάλεια λογαριασμού"]}),e.jsxs("button",{className:"w-full btn-secondary text-left flex items-center",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Ρυθμίσεις εφαρμογής"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Ενέργειες Λογαριασμού"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"w-full btn-secondary text-left",children:"Εξαγωγή δεδομένων"}),e.jsx("button",{className:"w-full btn-secondary text-left",children:"Απενεργοποίηση λογαριασμού"}),e.jsx("button",{className:"w-full btn-error text-left",children:"Διαγραφή λογαριασμού"})]})]})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Αλλαγή Κωδικού Πρόσβασης"}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:"×"})]}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Τρέχων Κωδικός"}),e.jsx("input",{type:"password",name:"currentPassword",value:u.currentPassword,onChange:v,required:!0,className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Νέος Κωδικός"}),e.jsx("input",{type:"password",name:"newPassword",value:u.newPassword,onChange:v,required:!0,className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Επιβεβαίωση Νέου Κωδικού"}),e.jsx("input",{type:"password",name:"confirmPassword",value:u.confirmPassword,onChange:v,required:!0,className:"input-field"})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"btn-secondary flex-1",children:"Ακύρωση"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Αλλαγή Κωδικού"})]})]})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ρυθμίσεις Ειδοποιήσεων"}),e.jsx("button",{onClick:()=>b(!1),className:"text-gray-400 hover:text-gray-600",children:"×"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Push ειδοποιήσεις"}),e.jsx("input",{type:"checkbox",name:"pushNotifications",checked:h.pushNotifications,onChange:f,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Email ειδοποιήσεις"}),e.jsx("input",{type:"checkbox",name:"emailNotifications",checked:h.emailNotifications,onChange:f,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"SMS ειδοποιήσεις"}),e.jsx("input",{type:"checkbox",name:"smsNotifications",checked:h.smsNotifications,onChange:f,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Marketing emails"}),e.jsx("input",{type:"checkbox",name:"marketingEmails",checked:h.marketingEmails,onChange:f,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Υπενθυμίσεις μαθημάτων"}),e.jsx("input",{type:"checkbox",name:"lessonReminders",checked:h.lessonReminders,onChange:f,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Υπενθυμίσεις πληρωμών"}),e.jsx("input",{type:"checkbox",name:"paymentReminders",checked:h.paymentReminders,onChange:f,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Ενημερώσεις παραπομπών"}),e.jsx("input",{type:"checkbox",name:"referralUpdates",checked:h.referralUpdates,onChange:f,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>b(!1),className:"btn-secondary flex-1",children:"Ακύρωση"}),e.jsx("button",{onClick:A,className:"btn-primary flex-1",children:"Αποθήκευση"})]})]})]})})]})};export{le as default};
